<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>System 10x7</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; background-color: #000; overflow: hidden; user-select: none; }
        
        .grid-container {
            width: 100%; height: 100%; display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(7, 3fr 2fr);
            padding: 2vmin; gap: 1.5vmin;
        }

        .image-box {
            position: relative; border: 2px solid #FF0000; background-color: #111;
            border-radius: 4px; width: 100%; height: 100%; cursor: pointer;
            overflow: hidden; background-size: cover; background-position: center;
            background-repeat: no-repeat; transition: border-color 0.1s;
        }
        .image-box::after {
            content: "+"; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); color: #444; font-size: 24px; font-weight: bold; pointer-events: none;
        }
        .image-box.has-image::after { display: none; }
        .image-box.active { border-color: #00FF00; }
        .image-box.selected-edit { border-color: #FFFF00 !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 255, 0, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 255, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 255, 0, 0); } }

        .toggle-cell { display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; }
        .circle-btn { height: 80%; aspect-ratio: 1 / 1; border-radius: 50%; background-color: #FF0000; border: 2px solid #000; cursor: pointer; }
        .circle-btn.active { background-color: #00FF00; }

        .file-input { display: none; }
        #status-log { position: fixed; top: 10px; left: 10px; color: #555; font-size: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <div id="status-log">Connecting...</div>
    <div class="grid-container" id="grid"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // YOUR CONFIG IS EMBEDDED HERE
        const firebaseConfig = {
            apiKey: "AIzaSyAYHA8Qw3Qzbyg8MtjrSKcJusNi4VaA6V4",
            authDomain: "system-data-bf026.firebaseapp.com",
            databaseURL: "https://system-data-bf026-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "system-data-bf026",
            storageBucket: "system-data-bf026.firebasestorage.app",
            messagingSenderId: "718302899022",
            appId: "1:718302899022:web:f1675dbcc293e138c68c1f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbRef = ref(db, 'system_10x7_data'); // Unique Folder for App 3

        let savedImages = new Array(70).fill(null);
        let savedState = new Array(70).fill(false);
        let allPairs = [];
        let selectedIndex = null;
        let isLongPress = false; let longPressTimer;

        onValue(dbRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                if(data.images) savedImages = data.images;
                if(data.state) savedState = data.state;
                refreshUI();
                document.getElementById('status-log').innerText = "LIVE";
                document.getElementById('status-log').style.color = "#0f0";
            }
        });

        function saveToCloud() {
            set(dbRef, { images: savedImages, state: savedState });
        }

        const grid = document.getElementById('grid');
        const cols = 10;
        const units = 7;
        let itemIndex = 0;

        for (let u = 0; u < units; u++) {
            let currentBoxes = [];
            for (let c = 0; c < cols; c++) {
                const idx = itemIndex + c;
                const box = document.createElement('div');
                box.className = 'image-box';
                const input = document.createElement('input');
                input.type = 'file'; input.accept = 'image/*'; input.className = 'file-input';
                
                input.onchange = (e) => {
                    if(e.target.files[0]) {
                        const reader = new FileReader();
                        reader.onload = (ev) => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, 100, 100);
                                savedImages[idx] = canvas.toDataURL('image/jpeg', 0.7);
                                saveToCloud();
                            };
                            img.src = ev.target.result;
                        };
                        reader.readAsDataURL(e.target.files[0]);
                    }
                };
                
                box.onmousedown = box.ontouchstart = () => {
                    isLongPress = false;
                    longPressTimer = setTimeout(() => { isLongPress = true; selectedIndex=idx; refreshUI(); }, 500);
                };
                box.onmouseup = box.ontouchend = () => clearTimeout(longPressTimer);

                box.onclick = () => {
                    if(!isLongPress) {
                        if(selectedIndex !== null) {
                            if(selectedIndex === idx) { savedImages[idx] = null; }
                            else { 
                                const t = savedImages[selectedIndex]; savedImages[selectedIndex] = savedImages[idx]; savedImages[idx] = t;
                                const s = savedState[selectedIndex]; savedState[selectedIndex] = savedState[idx]; savedState[idx] = s;
                            }
                            selectedIndex = null;
                            saveToCloud();
                            refreshUI();
                        } else { input.click(); }
                    }
                };
                
                box.appendChild(input);
                grid.appendChild(box);
                currentBoxes.push(box);
            }
            for (let c = 0; c < cols; c++) {
                const cell = document.createElement('div');
                cell.className = 'toggle-cell';
                const btn = document.createElement('div');
                btn.className = 'circle-btn';
                const sIdx = itemIndex;
                btn.onclick = () => { savedState[sIdx] = !savedState[sIdx]; saveToCloud(); };
                
                allPairs.push({ btn: btn, box: currentBoxes[c] });
                cell.appendChild(btn);
                grid.appendChild(cell);
                itemIndex++;
            }
        }

        function refreshUI() {
            for(let i=0; i<70; i++) {
                const pair = allPairs[i];
                if(savedImages[i]) { pair.box.style.backgroundImage = `url(${savedImages[i]})`; pair.box.classList.add('has-image'); }
                else { pair.box.style.backgroundImage = ''; pair.box.classList.remove('has-image'); }
                if(savedState[i]) { pair.box.classList.add('active'); pair.btn.classList.add('active'); }
                else { pair.box.classList.remove('active'); pair.btn.classList.remove('active'); }
                if(selectedIndex === i) pair.box.classList.add('selected-edit');
                else pair.box.classList.remove('selected-edit');
            }
        }
    </script>
</body>
</html>
